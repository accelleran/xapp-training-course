# Chapter 2: Adding and editing a configuration option 

We change the deployment time configruation options through Helm. We can then edit the configuration options via the dRAX Dashboard. 

To use the configruation options in the xapp_core, we use the following syntax:

```python
with settings.lock:
    our_new_config_option = settings.configuration['config']['TEST_CONFIG']
```

The configuration is stored in the settings variable. This variable has a Lock defined to safeguard the information. Using the Lock we can then read the configruation option.

# Chapter 3:

## The xApp Configuration JSON Schema

The xApp Configuration JSON Schema is as follows:

```json
{
    "metadata": {
        "name": "AUTO-GENERATED", # DON’T EDIT
        "configName": "GenericConfigName",
        "namespace": "AUTO-GENERATED" # DON’T EDIT
    },
    "description": "xApp Description...",
    "last_modified": "AUTO-GENERATED", # DON’T EDIT
    "config": {
        "API_GATEWAY_URL": "10.20.20.20", # AUTO-GENERATED, DON’T EDIT
        "API_GATEWAY_PORT": "31315", # AUTO-GENERATED, DON’T EDIT
        "REDIS_URL": "10.20.20.20", # AUTO-GENERATED, DON’T EDIT
        "REDIS_PORT": 32000, # AUTO-GENERATED, DON’T EDIT
        "DRAX_COMMAND_TOPIC": "Topic_OPENRAN_COMMANDS.OranController", # AUTO-GENERATED, DON’T EDIT
        "NATS_URL": "nats://10.20.20.20:31000", # AUTO-GENERATED, DON’T EDIT
        "LOG_LEVEL": 20,  
        "KAFKA_URL": "10.20.20.20", # AUTO-GENERATED, DON’T EDIT
        "KAFKA_PORT": "31090", # AUTO-GENERATED, DON’T EDIT
        "kafka_producer_topic": "xapp_specific_topic",
        "KAFKA_LISTEN_TOPIC": "test2, Topic_State",
        "periodic_publish": True, 
        "publish_interval": 1  # in seconds
    },
    "jsonSchemaOptions": {},
    "uiSchemaOptions": {}
}

```

## Create a subset of the xApp Configuration JSON

You can edit this this xApp Configuration JSON Schema and use the enpoint from the dRAX API Gateway to edit the configuration of an xApp. As you can see some of the fields are AUTOGENERATED. This means that Helm fills them in during deployment and they SHOULD NOT BE EDITED! Therefore, we can create a subset of the JSON with the options we want to change:

```json
{
    "metadata": {
        "configName": "GenericConfigName",
    },
    "description": "xApp Description...",
    "config": {
        "LOG_LEVEL": 20,  
        "kafka_producer_topic": "xapp_specific_topic",
        "KAFKA_LISTEN_TOPIC": "test2, Topic_State",
        "periodic_publish": True, 
        "publish_interval": 1,
        "TEST_CONFIG": "This is a config set via the JSON"
    },
    "jsonSchemaOptions": {},
    "uiSchemaOptions": {}
}
```

## Sending the xApp Configuration JSON

We can use the curl command (or you can use any other API client) to send the API request:

```shell
curl -X PUT -H "Content-Type: application/json" -d @/path/to/xapp-config.json http://<Kubernetes IP>:31315/api/xappconfiguration/config/<xApp Name>
```

Replace:
- /path/to/xapp-config.json: with the absolute path to the JSON file with the above contents
- <Kubernetes IP> with the Kubernetes IP of your setup
- <xApp name> with the name of the xApp you are sending the configuration to

NOTE: The xApp needs to be deployed for the configuration to be stored!

## Note on using the PUT vs POST API enpoint
We use the PUT method on the API enpoint as we are editing only parts of the configuration. If you use the POST method, you need to supply the whole configuration JSON, otherwise some things might get deleted. You can do this by first grabbing the xApp configuration using the GET method on the API endpoint:

```shell
curl -X GET -H "Content-Type: application/json" http://<Kubernetes IP>:31315/api/xappconfiguration/config/<xApp Name>
```

You can then save this JSON and edit it, taking into account that the autogenerated fields SHOULD NOT BE EDITED. Once you edit the configuration you can use the POST method to set the xApp configuration. 
